@model ESHOPPER.Models.SanPham

@{
    ViewBag.Title = "Cập nhật sản phẩm";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Active = "Sanpham";
}

<div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
        <h2 class="text-2xl font-bold text-slate-800">Chỉnh sửa sản phẩm</h2>
    </div>
    <div class="flex items-center gap-3">
        <a href="@Url.Action("ProductList")" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors">
            Hủy bỏ
        </a>
        <button form="editProductForm" type="submit" class="px-4 py-2 bg-brand-blue hover:bg-brand-dark text-white font-bold rounded-lg shadow-md transition-colors flex items-center gap-2">
            Lưu thay đổi
        </button>
    </div>
</div>

@using (Html.BeginForm("ProductEdit", "Admin", FormMethod.Post, new { id = "editProductForm", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(model => model.MaSP)
    @Html.HiddenFor(model => model.AnhSP)

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-2 space-y-6">
            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                <h3 class="text-lg font-semibold text-slate-800 mb-4 border-b pb-2">Thông tin chung</h3>
                <div class="space-y-4">
                    <div>
                        @Html.LabelFor(model => model.TenSanPham, "Tên sản phẩm", new { @class = "block text-sm font-medium text-slate-700 mb-1" })
                        @Html.EditorFor(model => model.TenSanPham, new { htmlAttributes = new { @class = "w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200 transition duration-200 placeholder-slate-400", placeholder = "Nhập tên sản phẩm..." } })
                        @Html.ValidationMessageFor(model => model.TenSanPham, "", new { @class = "text-red-500 text-xs mt-1" })
                    </div>
                    <div>
                        @Html.LabelFor(model => model.MoTa, "Mô tả chi tiết", new { @class = "block text-sm font-medium text-slate-700 mb-1" })
                        @Html.TextAreaFor(model => model.MoTa, new { @class = "w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200 transition duration-200 placeholder-slate-400 min-h-[150px]", placeholder = "Nhập mô tả sản phẩm..." })
                        @Html.ValidationMessageFor(model => model.MoTa, "", new { @class = "text-red-500 text-xs mt-1" })
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                <h3 class="text-lg font-semibold text-slate-800 mb-4 border-b pb-2">Hình ảnh sản phẩm</h3>

                <div class="flex flex-col md:flex-row gap-6 items-start">

                    <div class="w-full md:w-1/3 text-center">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Ảnh hiển thị</label>
                        <div class="relative group rounded-lg overflow-hidden border-2 border-dashed border-slate-300 bg-slate-50 h-48 flex items-center justify-center">

                            <img id="previewImage"
                                 src="@(string.IsNullOrEmpty(Model.AnhSP) ? "" : Url.Content("~/Images/Products/" + Model.AnhSP) + "?v=" + DateTime.Now.Ticks)"
                                 class="h-full w-full object-contain @(string.IsNullOrEmpty(Model.AnhSP) ? "hidden" : "")" />

                            <div id="placeholderIcon" class="@(!string.IsNullOrEmpty(Model.AnhSP) ? "hidden" : "") text-slate-400 flex flex-col items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <span class="text-xs">Chưa có ảnh</span>
                            </div>
                        </div>
                    </div>

                    <div class="w-full md:w-2/3">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Thay đổi ảnh mới</label>

                        <input type="file" name="ImageUpload" id="ImageUpload" accept="image/*" class="block w-full text-sm text-slate-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-brand-blue
                            hover:file:bg-blue-100 cursor-pointer border border-slate-300 rounded-lg p-1" />

                        <p class="text-xs text-slate-500 mt-2">Định dạng hỗ trợ: JPG, PNG. Hệ thống sẽ giữ tên file cũ và tự động tối ưu ảnh.</p>
                        @Html.ValidationMessageFor(model => model.AnhSP, "", new { @class = "text-red-500 text-xs mt-1" })
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                <h3 class="text-sm font-bold uppercase text-slate-400 tracking-wider mb-4">Phân loại & Giá</h3>
                <div class="space-y-4">
                    <div>
                        @Html.LabelFor(model => model.MaDM, "Danh mục", new { @class = "block text-sm font-medium text-slate-700 mb-1" })
                        @Html.DropDownList("MaDM", null, htmlAttributes: new { @class = "w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200 bg-slate-50" })
                    </div>
                    <div>
                        @Html.LabelFor(model => model.MaNCC, "Nhà cung cấp", new { @class = "block text-sm font-medium text-slate-700 mb-1" })
                        @Html.DropDownList("MaNCC", null, htmlAttributes: new { @class = "w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200 bg-slate-50" })
                    </div>
                    <div>
                        @Html.LabelFor(model => model.GiaBanLe, "Giá bán (VNĐ)", new { @class = "block text-sm font-medium text-slate-700 mb-1" })
                        <div class="relative">
                            @Html.EditorFor(model => model.GiaBanLe, new { htmlAttributes = new { @class = "w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200 pl-4 pr-12 font-semibold text-slate-700", type = "number" } })
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                <h3 class="text-sm font-bold uppercase text-slate-400 tracking-wider mb-4">Trạng thái</h3>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Trạng thái hiển thị</label>
                    <select name="TrangThai" class="w-full rounded-lg border-slate-300 focus:border-brand-blue focus:ring focus:ring-blue-200">
                        <option value="Hoạt động">Hoạt động</option>
                    </select>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-100">
                    <p class="text-xs text-slate-500">
                        <span class="font-semibold">Mã SP:</span> #@Model.MaSP <br>
                        <span class="font-semibold">Ngày cập nhật:</span> @DateTime.Now.ToString("dd/MM/yyyy")
                    </p>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>
        // Script xem trước ảnh
        document.getElementById('ImageUpload').onchange = function (evt) {
            var tgt = evt.target || window.event.srcElement,
                files = tgt.files;

            if (FileReader && files && files.length) {
                var fr = new FileReader();
                fr.onload = function () {
                    var img = document.getElementById('previewImage');
                    var icon = document.getElementById('placeholderIcon');

                    img.src = fr.result;
                    img.classList.remove('hidden');
                    if (icon) icon.classList.add('hidden');
                }
                fr.readAsDataURL(files[0]);
            }
        }
    </script>
}